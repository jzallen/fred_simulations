{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "AWS Systems Manager Parameter Store configuration for Epistemix Platform",

  "Parameters": {
    "Environment": {
      "Type": "String",
      "Description": "Environment name for parameter store path and tagging",
      "Default": "dev",
      "AllowedValues": ["dev", "staging", "production"]
    },
    "DBHost": {
      "Type": "String",
      "Description": "RDS database endpoint hostname",
      "MinLength": 1
    },
    "DBPort": {
      "Type": "String",
      "Description": "RDS database port",
      "Default": "5432"
    },
    "DBName": {
      "Type": "String",
      "Description": "RDS database name",
      "Default": "epistemixdb"
    },
    "DBUser": {
      "Type": "String",
      "Description": "RDS database username",
      "Default": "epistemixuser"
    },
    "DBPassword": {
      "Type": "String",
      "Description": "RDS database password (will be stored as SecureString)",
      "NoEcho": true,
      "MinLength": 8
    },
    "S3UploadBucket": {
      "Type": "String",
      "Description": "S3 bucket name for file uploads",
      "MinLength": 3
    },
    "AWSRegion": {
      "Type": "String",
      "Description": "AWS region for the application",
      "Default": "us-east-1"
    }
  },

  "Resources": {
    "DatabaseHostParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/database/host"
        },
        "Description": "RDS database endpoint hostname",
        "Type": "String",
        "Value": {
          "Ref": "DBHost"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "DatabaseConfiguration"
        }
      }
    },

    "DatabasePortParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/database/port"
        },
        "Description": "RDS database port",
        "Type": "String",
        "Value": {
          "Ref": "DBPort"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "DatabaseConfiguration"
        }
      }
    },

    "DatabaseNameParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/database/name"
        },
        "Description": "RDS database name",
        "Type": "String",
        "Value": {
          "Ref": "DBName"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "DatabaseConfiguration"
        }
      }
    },

    "DatabaseUserParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/database/user"
        },
        "Description": "RDS database username",
        "Type": "String",
        "Value": {
          "Ref": "DBUser"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "DatabaseConfiguration"
        }
      }
    },

    "DatabasePasswordParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/database/password"
        },
        "Description": "RDS database password (encrypted)",
        "Type": "SecureString",
        "Value": {
          "Ref": "DBPassword"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "DatabaseConfiguration"
        }
      }
    },

    "S3UploadBucketParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/s3/upload_bucket"
        },
        "Description": "S3 bucket name for file uploads",
        "Type": "String",
        "Value": {
          "Ref": "S3UploadBucket"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "S3Configuration"
        }
      }
    },

    "AWSRegionParameter": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/aws/region"
        },
        "Description": "AWS region for the application",
        "Type": "String",
        "Value": {
          "Ref": "AWSRegion"
        },
        "Tags": {
          "Project": "epistemix-platform",
          "Environment": {
            "Ref": "Environment"
          },
          "ManagedBy": "CloudFormation",
          "Purpose": "AWSConfiguration"
        }
      }
    }
  },

  "Outputs": {
    "ParameterPathPrefix": {
      "Description": "Parameter Store path prefix for this environment",
      "Value": {
        "Fn::Sub": "/epistemix/${Environment}"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-ParameterPathPrefix"
        }
      }
    },
    "DatabaseHostParameterName": {
      "Description": "Parameter name for database host",
      "Value": {
        "Ref": "DatabaseHostParameter"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-DatabaseHostParameterName"
        }
      }
    },
    "DatabasePasswordParameterName": {
      "Description": "Parameter name for database password (SecureString)",
      "Value": {
        "Ref": "DatabasePasswordParameter"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-DatabasePasswordParameterName"
        }
      }
    },
    "S3UploadBucketParameterName": {
      "Description": "Parameter name for S3 upload bucket",
      "Value": {
        "Ref": "S3UploadBucketParameter"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-S3UploadBucketParameterName"
        }
      }
    }
  }
}
