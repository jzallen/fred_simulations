template:
  path: ec2/ssm-bastion.json

parameters:
  # Network Configuration
  VPCId: vpc-00bb33feebfb59191
  SubnetId: subnet-0c6dc4a43d6d2269c  # Use first private subnet

  # RDS Security Group (from dev RDS stack)
  # Uses CloudFormation export from the RDS stack
  RDSSecurityGroupId: !stack_output dev/rds-postgres.yaml::SecurityGroupId

  # Instance Configuration
  InstanceType: t3.nano  # Cost-optimized, can be stopped when not in use

stack_tags:
  Project: epistemix-platform
  Environment: dev
  ManagedBy: sceptre
  Purpose: SSM Bastion for RDS Access

# Sceptre hooks for template validation
hooks:
  before_validate:
    - !cmd "echo '▶ Running cfn-lint on EC2 template...' && cfn-lint templates/ec2/ssm-bastion.json && echo '✓ cfn-lint passed'"
    - !cmd "echo '▶ Running cfn-guard security validation...' && cfn-guard validate --data templates/ec2/ssm-bastion.json --rules guard_rules/ec2_security_rules.guard --show-summary fail && echo '✓ cfn-guard passed'"
  before_create:
    - !cmd "echo '▶ Running cfn-lint on EC2 template...' && cfn-lint templates/ec2/ssm-bastion.json && echo '✓ cfn-lint passed'"
    - !cmd "echo '▶ Running cfn-guard security validation...' && cfn-guard validate --data templates/ec2/ssm-bastion.json --rules guard_rules/ec2_security_rules.guard --show-summary fail && echo '✓ cfn-guard passed'"
  before_update:
    - !cmd "echo '▶ Running cfn-lint on EC2 template...' && cfn-lint templates/ec2/ssm-bastion.json && echo '✓ cfn-lint passed'"
    - !cmd "echo '▶ Running cfn-guard security validation...' && cfn-guard validate --data templates/ec2/ssm-bastion.json --rules guard_rules/ec2_security_rules.guard --show-summary fail && echo '✓ cfn-guard passed'"
