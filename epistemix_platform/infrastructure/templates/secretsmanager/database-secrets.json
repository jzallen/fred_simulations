{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "AWS Secrets Manager secrets for Epistemix Platform database credentials",

  "Parameters": {
    "Environment": {
      "Type": "String",
      "Description": "Environment name for secret naming and tagging",
      "Default": "dev",
      "AllowedValues": ["dev", "staging", "production"]
    },
    "DBPassword": {
      "Type": "String",
      "Description": "RDS database password (will be stored securely in Secrets Manager)",
      "NoEcho": true,
      "MinLength": 8
    }
  },

  "Resources": {
    "DatabasePasswordSecret": {
      "Type": "AWS::SecretsManager::Secret",
      "Properties": {
        "Name": {
          "Fn::Sub": "/epistemix/${Environment}/database/password"
        },
        "Description": "RDS database password for Epistemix Platform (encrypted at rest)",
        "SecretString": {
          "Ref": "DBPassword"
        },
        "Tags": [
          {
            "Key": "Project",
            "Value": "epistemix-platform"
          },
          {
            "Key": "Environment",
            "Value": {
              "Ref": "Environment"
            }
          },
          {
            "Key": "ManagedBy",
            "Value": "CloudFormation"
          },
          {
            "Key": "Purpose",
            "Value": "DatabaseCredentials"
          },
          {
            "Key": "SecretType",
            "Value": "DatabasePassword"
          }
        ]
      }
    }
  },

  "Outputs": {
    "DatabasePasswordSecretArn": {
      "Description": "ARN of the database password secret",
      "Value": {
        "Ref": "DatabasePasswordSecret"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-DatabasePasswordSecretArn"
        }
      }
    },
    "DatabasePasswordSecretName": {
      "Description": "Name of the database password secret",
      "Value": {
        "Fn::Sub": "/epistemix/${Environment}/database/password"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-DatabasePasswordSecretName"
        }
      }
    }
  }
}
