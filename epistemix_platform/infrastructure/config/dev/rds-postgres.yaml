template:
  path: rds/rds-postgres.json

parameters:
  # Network Configuration
  VPCId: vpc-00bb33feebfb59191
  PrivateSubnetIds: subnet-0c6dc4a43d6d2269c,subnet-0065bf40913be1672
  VpcCidr: "172.31.0.0/16"  # Default VPC CIDR

  # Database Configuration
  DBName: epistemixdb
  DBUsername: epistemixuser
  DBPassword: !environment_variable EPISTEMIX_DB_PASSWORD
  DBInstanceClass: db.t3.micro
  AllocatedStorage: 20

  # Security Settings
  PubliclyAccessible: "false"  # FRED-30: Database is NOT publicly accessible
  DeveloperIP: !environment_variable DEVELOPER_IP
  EnableVPCAccess: "true"  # Allows access from VPC CIDR block
  LambdaSecurityGroupId: sg-05f10285a853e5085  # Lambda security group for RDS access

stack_tags:
  Project: epistemix-platform
  Environment: dev
  ManagedBy: sceptre

# Sceptre hooks for template validation
hooks:
  before_validate:
    - !cmd "echo '▶ (rds-postgres) Running cfn-lint...' && cfn-lint templates/rds/rds-postgres.json && echo '✓ (rds-postgres) cfn-lint passed'"
    - !cmd "echo '▶ (rds-postgres) Running cfn-guard security validation...' && cfn-guard validate --data templates/rds/rds-postgres.json --rules guard_rules/rds_security_rules.guard --show-summary fail && echo '✓ (rds-postgres) cfn-guard passed'"
  before_create:
    - !cmd "echo '▶ (rds-postgres) Running cfn-lint...' && cfn-lint templates/rds/rds-postgres.json && echo '✓ (rds-postgres) cfn-lint passed'"
    - !cmd "echo '▶ (rds-postgres) Running cfn-guard security validation...' && cfn-guard validate --data templates/rds/rds-postgres.json --rules guard_rules/rds_security_rules.guard --show-summary fail && echo '✓ (rds-postgres) cfn-guard passed'"
  before_update:
    - !cmd "echo '▶ (rds-postgres) Running cfn-lint...' && cfn-lint templates/rds/rds-postgres.json && echo '✓ (rds-postgres) cfn-lint passed'"
    - !cmd "echo '▶ (rds-postgres) Running cfn-guard security validation...' && cfn-guard validate --data templates/rds/rds-postgres.json --rules guard_rules/rds_security_rules.guard --show-summary fail && echo '✓ (rds-postgres) cfn-guard passed'"